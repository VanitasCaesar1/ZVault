---
interface Row {
  feature: string;
  zvault: boolean | string;
  hashicorp: boolean | string;
  infisical: boolean | string;
  doppler: boolean | string;
}

interface Category {
  name: string;
  rows: Row[];
}

const categories: Category[] = [
  {
    name: 'Pricing',
    rows: [
      { feature: 'License', zvault: 'MIT', hashicorp: 'BSL 1.1', infisical: 'MIT Expat', doppler: 'Proprietary' },
      { feature: 'Free tier', zvault: true, hashicorp: false, infisical: true, doppler: true },
      { feature: 'Starting price', zvault: '$8/dev/mo', hashicorp: '$1.58/hr', infisical: '$9/user/mo', doppler: '$7/user/mo' },
      { feature: 'Self-host free', zvault: true, hashicorp: 'BSL limits', infisical: true, doppler: false },
      { feature: 'Truly open source', zvault: true, hashicorp: false, infisical: true, doppler: false },
    ],
  },
  {
    name: 'AI & Developer Experience',
    rows: [
      { feature: 'AI Mode (MCP server)', zvault: true, hashicorp: false, infisical: false, doppler: false },
      { feature: 'zvault:// secret references', zvault: true, hashicorp: false, infisical: false, doppler: false },
      { feature: 'IDE setup (Cursor, Kiro, Continue)', zvault: '1 cmd', hashicorp: false, infisical: false, doppler: false },
      { feature: 'llms.txt generation', zvault: true, hashicorp: false, infisical: false, doppler: false },
      { feature: '.env import ‚Üí encrypted vault', zvault: true, hashicorp: false, infisical: true, doppler: true },
      { feature: 'Inject secrets at runtime', zvault: true, hashicorp: false, infisical: true, doppler: true },
      { feature: 'Setup time', zvault: '2 min', hashicorp: 'Hours', infisical: '~15 min', doppler: '~5 min' },
      { feature: '.env.example AI generation', zvault: true, hashicorp: false, infisical: false, doppler: false },
      { feature: 'Secret search from IDE', zvault: true, hashicorp: false, infisical: false, doppler: false },
    ],
  },
  {
    name: 'Security & Encryption',
    rows: [
      { feature: 'Encryption at rest', zvault: 'AES-256-GCM', hashicorp: 'AES-256-GCM', infisical: 'AES-256-GCM', doppler: 'AES-256' },
      { feature: "Shamir's Secret Sharing", zvault: true, hashicorp: true, infisical: false, doppler: false },
      { feature: 'Key zeroization (memory wipe)', zvault: true, hashicorp: false, infisical: false, doppler: 'N/A' },
      { feature: 'Constant-time token comparison', zvault: true, hashicorp: true, infisical: false, doppler: 'N/A' },
      { feature: 'Core dump prevention', zvault: true, hashicorp: false, infisical: false, doppler: 'N/A' },
      { feature: 'Memory locking (mlockall)', zvault: true, hashicorp: true, infisical: false, doppler: 'N/A' },
      { feature: 'Pure Rust crypto (no OpenSSL)', zvault: true, hashicorp: false, infisical: false, doppler: false },
      { feature: 'Seal/unseal lifecycle', zvault: true, hashicorp: true, infisical: false, doppler: false },
    ],
  },
  {
    name: 'Architecture',
    rows: [
      { feature: 'Single binary', zvault: true, hashicorp: true, infisical: false, doppler: false },
      { feature: 'Self-hosted option', zvault: true, hashicorp: true, infisical: true, doppler: false },
      { feature: 'Local-first (no cloud)', zvault: true, hashicorp: false, infisical: false, doppler: false },
      { feature: 'Docker required', zvault: false, hashicorp: false, infisical: true, doppler: 'N/A' },
      { feature: 'Runtime dependencies', zvault: 'None', hashicorp: 'None', infisical: 'Node+DB+Redis', doppler: 'N/A' },
      { feature: 'Binary size', zvault: '~15 MB', hashicorp: '~200 MB', infisical: '~500 MB+', doppler: 'N/A' },
    ],
  },
  {
    name: 'Engines & Features',
    rows: [
      { feature: 'KV secrets engine', zvault: true, hashicorp: true, infisical: true, doppler: true },
      { feature: 'Transit encryption', zvault: true, hashicorp: true, infisical: false, doppler: false },
      { feature: 'PKI / certificate authority', zvault: true, hashicorp: true, infisical: true, doppler: false },
      { feature: 'Secret versioning', zvault: true, hashicorp: true, infisical: true, doppler: true },
      { feature: 'Web dashboard', zvault: true, hashicorp: true, infisical: true, doppler: true },
      { feature: 'REST API', zvault: true, hashicorp: true, infisical: true, doppler: true },
      { feature: 'Dynamic credentials', zvault: 'Planned', hashicorp: true, infisical: true, doppler: 'Limited' },
      { feature: 'K8s operator', zvault: 'Planned', hashicorp: true, infisical: true, doppler: true },
    ],
  },
];

const totalFeatures = categories.reduce((s, c) => s + c.rows.length, 0);

// Helper to render cell HTML
function cellHtml(value: boolean | string, isZvault: boolean): string {
  if (value === true) {
    const bg = isZvault ? 'background:rgba(34,211,238,0.12)' : 'background:rgba(161,161,170,0.1)';
    const color = isZvault ? '#22d3ee' : '#a1a1aa';
    return `<span style="display:inline-flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:50%;${bg}"><svg width="12" height="12" viewBox="0 0 16 16" fill="none" stroke="${color}" stroke-width="2.5"><path d="M3 8l3.5 3.5L13 5"/></svg></span>`;
  }
  if (value === false) {
    return `<span style="color:rgba(113,113,122,0.3)">‚Äî</span>`;
  }
  if (value === 'N/A') {
    return `<span style="color:rgba(113,113,122,0.3)">N/A</span>`;
  }
  if (value === 'Planned') {
    return `<span style="color:#a78bfa;font-size:11px;font-weight:500">Planned</span>`;
  }
  const color = isZvault ? '#22d3ee' : '#a1a1aa';
  const weight = isZvault ? '600' : '400';
  return `<span style="color:${color};font-weight:${weight};font-size:12px">${value}</span>`;
}
---

<section class="py-24 relative overflow-hidden" id="comparison">
  <div class="container relative">
    <div class="text-center mb-6">
      <div class="inline-flex items-center gap-2 text-xs font-semibold text-accent uppercase tracking-wider mb-4 px-3 py-1.5 rounded-full border border-accent/20 bg-accent/5">
        Compare
      </div>
      <h2 class="text-3xl md:text-5xl font-bold tracking-tight mb-4">How ZVault stacks up</h2>
      <p class="text-muted text-base max-w-lg mx-auto">
        The only secrets manager built for the AI coding era. Compare across {totalFeatures}+ features.
      </p>
    </div>

    <p class="text-dim text-xs text-center mb-8 sm:hidden">‚Üê Scroll horizontally ‚Üí</p>

    <div class="comp-wrapper">
      <div class="comp-scroll">
        <table class="comp-table">
          <thead>
            <tr>
              <th class="col-feature"></th>
              <th class="col-brand col-zv">
                <div class="brand-cell">
                  <div class="brand-icon zv-icon">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 2L2 7l10 5 10-5-10-5z" stroke="#22d3ee" stroke-width="2" stroke-linejoin="round"/><path d="M2 17l10 5 10-5" stroke="#22d3ee" stroke-width="2" stroke-linejoin="round"/><path d="M2 12l10 5 10-5" stroke="#22d3ee" stroke-width="2" stroke-linejoin="round"/></svg>
                  </div>
                  <span class="bname zv-name">ZVault</span>
                  <a href="https://docs.zvault.cloud/getting-started/installation" class="zv-btn">Get Started</a>
                </div>
              </th>
              <th class="col-brand">
                <div class="brand-cell">
                  <div class="brand-icon ot-icon"><span style="font-size:16px">üîí</span></div>
                  <span class="bname">HashiCorp</span>
                </div>
              </th>
              <th class="col-brand">
                <div class="brand-cell">
                  <div class="brand-icon ot-icon"><span style="font-size:16px">üîê</span></div>
                  <span class="bname">Infisical</span>
                </div>
              </th>
              <th class="col-brand">
                <div class="brand-cell">
                  <div class="brand-icon ot-icon"><span style="font-size:16px">üîë</span></div>
                  <span class="bname">Doppler</span>
                </div>
              </th>
            </tr>
          </thead>
          <tbody>
            {categories.map((cat) => (
              <>
                <tr class="cat-row">
                  <td colspan="5" class="cat-cell">{cat.name}</td>
                </tr>
                {cat.rows.map((row) => (
                  <tr class="feat-row">
                    <td class="feat-name">{row.feature}</td>
                    <td class="feat-val zv-col" set:html={cellHtml(row.zvault, true)} />
                    <td class="feat-val" set:html={cellHtml(row.hashicorp, false)} />
                    <td class="feat-val" set:html={cellHtml(row.infisical, false)} />
                    <td class="feat-val" set:html={cellHtml(row.doppler, false)} />
                  </tr>
                ))}
              </>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>

<style>
  .comp-wrapper {
    max-width: 960px;
    margin: 0 auto;
    border-radius: 16px;
    border: 1px solid #27272a;
    background: #111113;
    overflow: hidden;
  }
  .comp-scroll {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
  .comp-table {
    width: 100%;
    min-width: 700px;
    border-collapse: collapse;
    font-size: 13px;
  }

  thead tr { border-bottom: 1px solid #27272a; }
  .col-feature { width: 220px; padding: 20px 20px 16px; }
  .col-brand {
    width: calc((100% - 220px) / 4);
    padding: 20px 12px 16px;
    text-align: center;
    vertical-align: bottom;
  }
  .col-zv { background: rgba(34,211,238,0.03); }

  .brand-cell {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
  }
  .brand-icon {
    width: 36px;
    height: 36px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .zv-icon { background: rgba(34,211,238,0.1); border: 1px solid rgba(34,211,238,0.2); }
  .ot-icon { background: rgba(255,255,255,0.05); border: 1px solid #27272a; }
  .bname { font-size: 13px; font-weight: 600; color: #a1a1aa; }
  .zv-name { color: #22d3ee; }
  .zv-btn {
    display: inline-block;
    font-size: 11px;
    font-weight: 600;
    padding: 5px 14px;
    border-radius: 999px;
    text-decoration: none;
    margin-top: 2px;
    background: #22d3ee;
    color: #0a0a0b;
    transition: opacity 0.2s;
  }
  .zv-btn:hover { opacity: 0.9; }

  .cat-row { background: rgba(255,255,255,0.02); }
  .cat-cell {
    padding: 10px 20px;
    font-size: 13px;
    font-weight: 700;
    color: #fafafa;
    border-top: 1px solid #27272a;
  }

  .feat-row { border-top: 1px solid rgba(39,39,42,0.5); }
  .feat-row:hover { background: rgba(34,211,238,0.02); }
  .feat-name { padding: 10px 20px; color: #a1a1aa; }
  .feat-val { padding: 10px 12px; text-align: center; }
  .zv-col { background: rgba(34,211,238,0.03); }
</style>
