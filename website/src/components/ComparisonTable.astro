---
// Quick wins ‚Äî the headline differentiators shown as cards
const highlights = [
  {
    label: 'AI Mode (MCP Server)',
    zvault: true,
    others: 'Nobody else',
    icon: '‚ö°',
    desc: 'Native IDE integration for Cursor, Kiro, Continue. AI sees secret names, never values.',
  },
  {
    label: 'Setup Time',
    zvault: '2 min',
    others: 'Hours ‚Üí Days',
    icon: '‚è±Ô∏è',
    desc: 'One curl command. Import your .env. Done.',
  },
  {
    label: 'License',
    zvault: 'MIT',
    others: 'BSL / Proprietary',
    icon: 'üìú',
    desc: 'Truly open source. No BSL restrictions, no vendor lock-in.',
  },
  {
    label: 'Dependencies',
    zvault: 'None',
    others: 'Node + DB + Redis',
    icon: 'üì¶',
    desc: 'Single Rust binary. No Docker, no database, no runtime deps.',
  },
  {
    label: 'Local-First',
    zvault: true,
    others: 'Cloud required',
    icon: 'üíª',
    desc: 'Secrets never leave your machine. No cloud account needed.',
  },
  {
    label: 'Starting Price',
    zvault: '$0 (free tier)',
    others: '$7-18/user/mo',
    icon: 'üí∞',
    desc: 'Full vault free forever. AI Mode from $8/dev/mo.',
  },
];

// Detailed comparison rows grouped by category
interface Row {
  feature: string;
  zvault: boolean | string;
  hashicorp: boolean | string;
  infisical: boolean | string;
  doppler: boolean | string;
}

interface Category {
  name: string;
  rows: Row[];
}

const categories: Category[] = [
  {
    name: 'AI & Developer Experience',
    rows: [
      { feature: 'AI Mode (MCP server)', zvault: true, hashicorp: false, infisical: false, doppler: false },
      { feature: 'zvault:// secret references', zvault: true, hashicorp: false, infisical: false, doppler: false },
      { feature: 'IDE setup (Cursor, Kiro, Continue)', zvault: '1 cmd', hashicorp: false, infisical: false, doppler: false },
      { feature: 'llms.txt generation', zvault: true, hashicorp: false, infisical: false, doppler: false },
      { feature: '.env import ‚Üí encrypted vault', zvault: true, hashicorp: false, infisical: true, doppler: true },
      { feature: 'zvault run (inject at runtime)', zvault: true, hashicorp: false, infisical: true, doppler: true },
      { feature: 'Setup time', zvault: '2 min', hashicorp: 'Hours', infisical: '~15 min', doppler: '~5 min' },
      { feature: '.env.example AI generation', zvault: true, hashicorp: false, infisical: false, doppler: false },
      { feature: 'Secret search from IDE', zvault: true, hashicorp: false, infisical: false, doppler: false },
    ],
  },
  {
    name: 'Security & Encryption',
    rows: [
      { feature: 'Encryption at rest', zvault: 'AES-256-GCM', hashicorp: 'AES-256-GCM', infisical: 'AES-256-GCM', doppler: 'AES-256' },
      { feature: 'Shamir\'s Secret Sharing', zvault: true, hashicorp: true, infisical: false, doppler: false },
      { feature: 'Key zeroization (memory wipe)', zvault: true, hashicorp: false, infisical: false, doppler: 'N/A' },
      { feature: 'Constant-time token comparison', zvault: true, hashicorp: true, infisical: false, doppler: 'N/A' },
      { feature: 'Core dump prevention', zvault: true, hashicorp: false, infisical: false, doppler: 'N/A' },
      { feature: 'Memory locking (mlockall)', zvault: true, hashicorp: true, infisical: false, doppler: 'N/A' },
      { feature: 'Pure Rust crypto (no OpenSSL)', zvault: true, hashicorp: false, infisical: false, doppler: false },
      { feature: 'Seal/unseal lifecycle', zvault: true, hashicorp: true, infisical: false, doppler: false },
    ],
  },
  {
    name: 'Architecture',
    rows: [
      { feature: 'Single binary', zvault: true, hashicorp: true, infisical: false, doppler: false },
      { feature: 'Self-hosted option', zvault: true, hashicorp: true, infisical: true, doppler: false },
      { feature: 'Local-first (no cloud)', zvault: true, hashicorp: false, infisical: false, doppler: false },
      { feature: 'Docker required', zvault: false, hashicorp: false, infisical: true, doppler: 'N/A' },
      { feature: 'Runtime dependencies', zvault: 'None', hashicorp: 'None', infisical: 'Node+DB+Redis', doppler: 'N/A' },
      { feature: 'Binary size', zvault: '~15 MB', hashicorp: '~200 MB', infisical: '~500 MB+', doppler: 'N/A' },
    ],
  },
  {
    name: 'Engines & Features',
    rows: [
      { feature: 'KV secrets engine', zvault: true, hashicorp: true, infisical: true, doppler: true },
      { feature: 'Transit encryption', zvault: true, hashicorp: true, infisical: false, doppler: false },
      { feature: 'PKI / certificate authority', zvault: true, hashicorp: true, infisical: true, doppler: false },
      { feature: 'Secret versioning', zvault: true, hashicorp: true, infisical: true, doppler: true },
      { feature: 'Web dashboard', zvault: true, hashicorp: true, infisical: true, doppler: true },
      { feature: 'REST API', zvault: true, hashicorp: true, infisical: true, doppler: true },
      { feature: 'Dynamic credentials', zvault: 'Planned', hashicorp: true, infisical: true, doppler: 'Limited' },
      { feature: 'K8s operator', zvault: 'Planned', hashicorp: true, infisical: true, doppler: true },
    ],
  },
  {
    name: 'Pricing & Licensing',
    rows: [
      { feature: 'License', zvault: 'MIT', hashicorp: 'BSL 1.1', infisical: 'MIT Expat', doppler: 'Proprietary' },
      { feature: 'Free tier', zvault: true, hashicorp: false, infisical: true, doppler: true },
      { feature: 'Starting price', zvault: '$8/dev/mo', hashicorp: '$1.58/hr', infisical: '$9/user/mo', doppler: '$7/user/mo' },
      { feature: 'Self-host free', zvault: true, hashicorp: 'BSL limits', infisical: true, doppler: false },
      { feature: 'Truly open source', zvault: true, hashicorp: false, infisical: true, doppler: false },
    ],
  },
];

function renderCell(value: boolean | string, isZvault: boolean = false) {
  if (value === true) return { text: '‚úì', cls: isZvault ? 'text-accent font-bold' : 'text-green font-semibold' };
  if (value === false) return { text: '‚úó', cls: 'text-dim/40' };
  if (value === 'N/A') return { text: '‚Äî', cls: 'text-dim/30' };
  if (value === 'Planned') return { text: value, cls: 'text-purple text-[11px] font-medium' };
  return { text: String(value), cls: isZvault ? 'text-accent font-medium text-[11px]' : 'text-muted text-[11px]' };
}
---

<section class="py-24 relative overflow-hidden" id="comparison">
  <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] bg-accent/[0.02] rounded-full blur-[120px] pointer-events-none"></div>

  <div class="container relative">
    <div class="text-center mb-14">
      <div class="inline-flex items-center gap-2 text-xs font-semibold text-accent uppercase tracking-wider mb-4 px-3 py-1.5 rounded-full border border-accent/20 bg-accent/5">
        Why ZVault
      </div>
      <h2 class="text-3xl md:text-5xl font-bold tracking-tight mb-4">How ZVault stacks up</h2>
      <p class="text-muted text-lg max-w-xl mx-auto">
        The only secrets manager built for the AI coding era.
      </p>
    </div>

    <!-- Highlight cards ‚Äî the quick visual differentiators -->
    <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-3 max-w-4xl mx-auto mb-16">
      {highlights.map((h) => (
        <div class="bg-bg-card border border-border rounded-xl p-4 hover:border-accent/20 transition-colors">
          <div class="flex items-center gap-2 mb-2">
            <span class="text-base">{h.icon}</span>
            <span class="text-xs font-semibold text-white">{h.label}</span>
          </div>
          <div class="flex items-center gap-3 mb-2">
            <div class="flex items-center gap-1.5">
              <span class="text-[10px] text-dim uppercase tracking-wider">ZVault</span>
              <span class="text-xs font-bold text-accent">{typeof h.zvault === 'boolean' ? '‚úì' : h.zvault}</span>
            </div>
            <div class="w-px h-3 bg-border"></div>
            <div class="flex items-center gap-1.5">
              <span class="text-[10px] text-dim uppercase tracking-wider">Others</span>
              <span class="text-xs text-dim">{h.others}</span>
            </div>
          </div>
          <p class="text-[11px] text-dim leading-relaxed">{h.desc}</p>
        </div>
      ))}
    </div>

    <!-- Detailed comparison table -->
    <div class="max-w-4xl mx-auto">
      <h3 class="text-lg font-bold text-center mb-2">Detailed comparison</h3>
      <p class="text-dim text-xs text-center mb-6">Across {categories.reduce((sum, c) => sum + c.rows.length, 0)}+ features</p>

      <p class="text-dim text-xs text-center mb-4 sm:hidden">‚Üê Scroll horizontally ‚Üí</p>

      <div class="overflow-x-auto rounded-xl border border-border bg-bg-card/30">
        <table class="w-full text-[12px] min-w-[600px]">
          <thead class="sticky top-0 z-10">
            <tr class="border-b border-border bg-bg-card/95 backdrop-blur-sm">
              <th class="text-left px-4 py-3 text-[10px] text-dim uppercase tracking-wider font-semibold w-[200px]">Feature</th>
              <th class="px-3 py-3 text-center w-[90px]">
                <span class="text-accent font-bold text-[11px]">ZVault</span>
              </th>
              <th class="px-3 py-3 text-center w-[90px]">
                <span class="text-muted font-semibold text-[11px]">HashiCorp</span>
              </th>
              <th class="px-3 py-3 text-center w-[90px]">
                <span class="text-muted font-semibold text-[11px]">Infisical</span>
              </th>
              <th class="px-3 py-3 text-center w-[90px]">
                <span class="text-muted font-semibold text-[11px]">Doppler</span>
              </th>
            </tr>
          </thead>
          <tbody>
            {categories.map((cat) => (
              <>
                <tr class="bg-bg/60">
                  <td colspan="5" class="px-4 py-2 border-t border-border">
                    <span class="text-[10px] font-bold text-white uppercase tracking-wider">{cat.name}</span>
                  </td>
                </tr>
                {cat.rows.map((row) => {
                  const zv = renderCell(row.zvault, true);
                  const hc = renderCell(row.hashicorp);
                  const inf = renderCell(row.infisical);
                  const dop = renderCell(row.doppler);
                  return (
                    <tr class="border-t border-border/20 hover:bg-accent/[0.02] transition-colors">
                      <td class="px-4 py-2 text-muted">{row.feature}</td>
                      <td class={`px-3 py-2 text-center bg-accent/[0.02] ${zv.cls}`}>{zv.text}</td>
                      <td class={`px-3 py-2 text-center ${hc.cls}`}>{hc.text}</td>
                      <td class={`px-3 py-2 text-center ${inf.cls}`}>{inf.text}</td>
                      <td class={`px-3 py-2 text-center ${dop.cls}`}>{dop.text}</td>
                    </tr>
                  );
                })}
              </>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>
